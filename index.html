<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Birthday Surprise</title>
<style>
  html, body {
    margin: 0; padding: 0; background: #0a0a0a; overflow: hidden; height: 100%;
    font-family: monospace;
  }
  canvas { display: block; }
  .rotate-message {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: #000;
    display: flex; flex-direction: column;
    justify-content: center; align-items: center;
    z-index: 1000; color: #FF69B4;
    text-align: center;
  }
  .phone-icon { font-size: 80px; animation: rotatePhone 2s infinite ease-in-out; margin-bottom: 20px; }
  .rotate-text { font-size: 24px; margin-bottom: 10px; }
  .rotate-subtext { font-size: 16px; opacity: 0.7; }
  @keyframes rotatePhone { 0%,100% { transform: rotate(0deg); } 50% { transform: rotate(90deg); } }
  .hidden { display: none; }
  .final-message {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    color: #FFB6C1;
    font-size: 2em;
    text-align: center;
    opacity: 0;
    transition: opacity 1s ease-in-out;
    pointer-events: auto;
    cursor: pointer;
  }
</style>
</head>
<body>

<div id="rotateMessage" class="rotate-message hidden">
  <div class="phone-icon">📱</div>
  <div class="rotate-text">Please rotate your device</div>
  <div class="rotate-subtext">Turn to landscape mode</div>
</div>

<canvas id="canvas"></canvas>
<div id="finalMessage" class="final-message"></div>

<script>
(() => {
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');
  const rotateMessage = document.getElementById('rotateMessage');
  const finalMessage = document.getElementById('finalMessage');

  let W, H, started = false, animationId = null, frameCount = 0, matrixSpeed = 0;
  const characters = 'HAPPY BIRTHDAY<33'.split('');
  const sequence = ['3','2','1','HAPPY','BIRTHDAY','MY WHITECAT<3','❤'];
  let current = 0;

  let particles = [], drops = [], columns = 0, hearts = [];
  const countdownDelay = 2500;
  let resizeTimeout;

  const finalTexts = [
    "Here’s to a day that sparkles with love and overflows with joy",
    "Thanks for everything you have done for me",
    "I will always cherish these memories",
         "You are my sunshine, my love, and my best friend",
    "Happy Birthday, my love! Here's to many more together!",
  ];
  let finalIndex = 0;

  function resize() {
    W = canvas.width = window.innerWidth;
    H = canvas.height = window.innerHeight;
    const fontSizeResponsive = Math.floor(Math.min(W, H) * 0.02);
    columns = Math.ceil(W / fontSizeResponsive);
    drops = Array(columns).fill(1);
  }

  class Particle {
    constructor(x, y, color) {
      this.x = Math.random() * W;
      this.y = Math.random() * H;
      this.tx = x; this.ty = y;
      this.vx = (Math.random() - 0.5) * 25;
      this.vy = (Math.random() - 0.5) * 25;
      this.size = Math.random() * 3 + 1;
      this.opacity = 0;
      this.color = color;
    }
    update() {
      const dx = this.tx - this.x;
      const dy = this.ty - this.y;
      this.vx += dx * 0.1;
      this.vy += dy * 0.1;
      this.vx *= 0.8;
      this.vy *= 0.8;
      this.x += this.vx;
      this.y += this.vy;
      if(this.opacity<1) this.opacity += 0.05;
    }
    draw() {
      ctx.save();
      ctx.shadowColor = '#FF69B4';
      ctx.shadowBlur = 8;
      ctx.fillStyle = `rgba(${this.color[0]},${this.color[1]},${this.color[2]},${this.opacity})`;
      ctx.beginPath();
      ctx.arc(this.x,this.y,this.size,0,Math.PI*2);
      ctx.fill();
      ctx.restore();
    }
  }

  class Heart {
    constructor() {
      this.x = Math.random()*W;
      this.y = -20;
      this.size = Math.random()*12 + 8;
      this.speed = Math.random()*2 + 1;
      this.opacity = Math.random()*0.5 + 0.5;
      this.angle = Math.random()*Math.PI*2;
    }
    update() {
      this.y += this.speed;
      this.x += Math.sin(this.angle)*0.5;
      this.angle += 0.02;
      if(this.y>H) this.y=-20;
    }
    draw() {
      ctx.save();
      ctx.fillStyle = `rgba(255,182,193,${this.opacity})`;
      ctx.beginPath();
      ctx.moveTo(this.x,this.y);
      ctx.bezierCurveTo(this.x,this.y-this.size/2,this.x+this.size,this.y-this.size/2,this.x,this.y+this.size/2);
      ctx.bezierCurveTo(this.x-this.size,this.y-this.size/2,this.x,this.y-this.size/2,this.x,this.y);
      ctx.fill();
      ctx.restore();
    }
  }

  function createParticlesForText(text) {
    particles=[];
    const tempCanvas = document.createElement('canvas');
    const tctx = tempCanvas.getContext('2d');
    tempCanvas.width=W; tempCanvas.height=H;
    tctx.clearRect(0,0,W,H);
    // Responsive font size
    const fontSizeText = Math.floor(Math.min(W,H)*0.15);
    tctx.font=`bold ${fontSizeText}px Arial`;
    tctx.textAlign='center';
    tctx.textBaseline='middle';
    tctx.fillStyle='#fff';
    tctx.fillText(text,W/2,H/2);

    const imgData = tctx.getImageData(0,0,W,H);
    // Responsive step for density
    const step = Math.max(6, Math.floor(Math.max(W, H) / 200));
    for(let y=0;y<H;y+=step){
      for(let x=0;x<W;x+=step){
        const idx=(y*W+x)*4;
        if(imgData.data[idx+3]>128){
          particles.push(new Particle(x,y,[255,105,180]));
        }
      }
    }
  }

  function countdown() {
    if(current >= sequence.length){
      showFinalText();
      return;
    }
    createParticlesForText(sequence[current]);
    setTimeout(()=>{
      particles.forEach(p=>{
        const angle=Math.random()*2*Math.PI;
        const speed=Math.random()*15+8;
        p.tx = p.x + Math.cos(angle)*speed*29;
        p.ty = p.y + Math.sin(angle)*speed*29;
      });
      setTimeout(()=>{
        current++;
        countdown();
      },700);
    },2000);
  }

  function animate(){
    animationId = requestAnimationFrame(animate);
    frameCount++; matrixSpeed++;
    ctx.fillStyle='rgba(0,0,0,0.1)';
    ctx.fillRect(0,0,W,H);

    if(matrixSpeed%3===0){
      ctx.save();
      ctx.fillStyle='#FF69B4';
      const fontSizeResponsive = Math.floor(Math.min(W, H) * 0.02);
      ctx.font=`${fontSizeResponsive}px monospace`;
      ctx.shadowColor='#FF69B4';
      ctx.shadowBlur=6;
      const horizontalOffset = (W - columns*fontSizeResponsive)/2;
      for(let i=0;i<drops.length;i++){
        const text = characters[Math.floor(Math.random()*characters.length)];
        const xPos = i*fontSizeResponsive + horizontalOffset;
        ctx.fillText(text,xPos,drops[i]*fontSizeResponsive);
        if(drops[i]*fontSizeResponsive>H && Math.random()>0.975) drops[i]=0;
        drops[i]++;
      }
      ctx.restore();
    }

    particles.forEach(p=>{ p.update(); p.draw(); });
    if(particles.length>4500) particles=particles.slice(0,4500);
    hearts.forEach(h=>{ h.update(); h.draw(); });
  }

  function showFinalText(){
    if(finalIndex >= finalTexts.length) return;
    finalMessage.textContent = finalTexts[finalIndex];
    finalMessage.style.opacity = 1;
  }

  finalMessage.addEventListener('click', ()=>{
    finalIndex++;
    if(finalIndex < finalTexts.length){
      finalMessage.style.opacity = 0;
      setTimeout(()=>{ showFinalText(); }, 500);
    }
  });

  function checkOrientation(){
    const isLandscape = window.innerWidth>window.innerHeight;
    const isMobile = window.innerWidth<=768;
    if(!isMobile || (isMobile && isLandscape)){
      rotateMessage.classList.add('hidden');
      if(!started){
        resize();
        hearts = Array.from({length:50},()=>new Heart());
        startEffect();
      }
    } else {
      rotateMessage.classList.remove('hidden');
      if(started){
        cancelAnimationFrame(animationId);
        animationId=null;
        started=false;
        ctx.clearRect(0,0,W,H);
      }
    }
  }

  function startEffect(){
    started=true;
    animate();
    setTimeout(()=>{
      current=0;
      countdown();
    },countdownDelay);
  }

  window.addEventListener('resize',()=>{
    clearTimeout(resizeTimeout);
    resizeTimeout = setTimeout(()=>{
      checkOrientation();
      if(started) resize();
    },200);
  });
  window.addEventListener('orientationchange',()=>setTimeout(checkOrientation,400));

  checkOrientation();
})();
</script>

</body>
</html>
